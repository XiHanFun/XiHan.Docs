# 开发框架

## 概述

**XiHan.Framework** 是一个基于 .NET 10 的企业级开发框架，采用模块化设计，提供 50+ 个功能模块，帮助开发者快速构建高性能、可扩展的企业应用。

## 核心优势

### 模块化设计

框架采用高度模块化的设计，每个功能都封装在独立的 NuGet 包中，您可以：

- 按需引入所需模块
- 避免不必要的依赖
- 降低应用体积
- 提高启动速度

### 领域驱动设计

完整支持 DDD（领域驱动设计）思想：

- **聚合根** - 管理实体生命周期
- **实体** - 业务对象建模
- **值对象** - 不可变的值类型
- **领域事件** - 领域内的事件通知
- **领域服务** - 跨聚合根的业务逻辑
- **规约模式** - 封装查询条件

### 高性能

充分利用 .NET 10 的性能优势：

- 支持 AOT 编译
- 优先使用原生功能
- 异步编程优先
- 高性能序列化
- 内存优化

## 架构模式

### 分层架构

```
┌─────────────────────────────────┐
│      表现层（Presentation）      │  Web API、SignalR、中间件
├─────────────────────────────────┤
│      应用层（Application）       │  应用服务、DTO、命令查询
├─────────────────────────────────┤
│       领域层（Domain）           │  聚合根、实体、领域服务
├─────────────────────────────────┤
│   基础设施层（Infrastructure）   │  数据访问、缓存、消息队列
└─────────────────────────────────┘
```

### CQRS 模式

支持命令查询分离（CQRS）：

- **命令（Command）** - 处理写操作
- **查询（Query）** - 处理读操作
- 读写分离，优化性能

## 核心模块

### 基础核心

#### 核心模块（Core）
提供框架的核心功能：
- 模块化系统
- 依赖注入集成
- 配置管理
- 异常处理
- 结果模式
- 实体基类

#### 工具模块（Utils）
丰富的工具函数库：
- 字符串处理（70+ 扩展方法）
- 安全算法（Hash、AES、RSA、DES、ECDSA）
- 异步工具
- 序列化（JSON、XML、YAML）
- 集合操作
- 反射工具
- 网络通信
- 文件 IO
- 时间处理

### 数据访问

#### 数据访问模块（Data）
- 仓储模式实现
- 支持多种 ORM（SqlSugar、EF Core、Dapper）
- 规约模式支持
- 数据初始化和种子

#### 工作单元模块（Uow）
- 事务管理
- 嵌套工作单元
- 事件集成
- 变更追踪

### 领域层

#### 领域模块（Domain）
- 聚合根基类
- 实体基类
- 领域事件
- 值对象
- 规约模式
- 业务规则验证

### 缓存

#### 缓存模块（Caching）
- 分布式缓存
- 混合缓存（内存 + 分布式）
- Redis 支持
- 批量操作
- 工作单元集成

### 事件驱动

#### 事件总线模块（EventBus）
- 本地事件总线
- 分布式事件总线
- 事件订阅管理
- 工作单元集成
- 多租户支持

### 多租户

#### 多租户模块（MultiTenancy）
- 租户上下文管理
- 租户解析策略
- 数据隔离
- 租户配置
- 租户生命周期管理

### 认证授权

#### 认证模块（Authentication）
- JWT 认证
- OAuth 2.0 / OpenID Connect
- 多因素认证（MFA）
- 单点登录（SSO）
- 会话管理

#### 授权模块（Authorization）
- 基于角色的访问控制（RBAC）
- 资源访问控制
- 动态授权
- 细粒度权限
- 权限继承

### 后台任务

#### 任务模块（Tasks）
- 任务调度
- 任务执行
- 分布式任务
- 任务依赖解析
- 重试策略
- 性能监控

### 应用层

#### 应用服务模块（Application）
- 应用服务基类
- CRUD 服务基类
- 批量操作服务
- 动态 API 生成

### Web 层

#### Web 核心模块（Web.Core）
- Web 主机构建
- 中间件管道
- HTTP 上下文增强
- 健康检查

#### Web API 模块（Web.Api）
- API 控制器基类
- 模型绑定
- API 版本管理
- 响应格式化
- CQRS 路由

#### API 文档模块（Web.Docs）
- OpenAPI 文档生成
- 客户端代码生成
- 文档模板
- API 示例

#### 实时通信模块（Web.RealTime）
- SignalR 集成
- 连接管理
- 实时通知
- 用户标识

### 横切关注点

#### 序列化模块（Serialization）
- JSON 序列化（System.Text.Json）
- XML 序列化
- YAML 序列化
- 流式序列化

#### 日志模块（Logging）
- 结构化日志
- 日志上下文
- 关联 ID 追踪
- 动态日志级别

#### 对象映射模块（ObjectMapping）
- Entity ↔ DTO 转换
- 高性能映射
- 自定义映射规则
- 表达式编译

#### 验证模块（Validation）
- 数据注解验证
- FluentValidation 集成
- 异步验证
- 验证规则构建器

#### 设置模块（Settings）
- 配置提供者
- 动态配置
- 配置变更通知
- 分组管理

#### 国际化模块（Localization）
- 多语言支持
- 资源文件管理
- 文化上下文
- 本地化缓存

### 基础设施

#### HTTP 客户端模块（Http）
- HTTP 客户端工厂
- 请求构建器
- 响应处理管道
- 拦截器链
- 重试策略

#### 安全模块（Security）
- 密码学提供者
- 密钥管理
- 数据保护
- 安全审计

#### 分布式 ID 模块（DistributedIds）
- 雪花算法（Snowflake）
- ULID、SQID、NanoID
- 序列管理
- 节点协调

#### 对象存储模块（ObjectStorage）
- 本地文件存储
- 阿里云 OSS
- 腾讯云 COS
- MinIO
- 分片上传

#### 可观测性模块（Observability）
- 诊断服务
- 健康检查
- 指标收集
- 性能监控

#### 模板引擎模块（Templating）
- 模板解析
- 模板编译
- 模板上下文
- 模板继承

#### 脚本执行模块（Script）
- 脚本运行时
- 动态编译
- 沙箱执行
- 脚本安全

#### AI 模块（AI）
- AI 服务提供者
- 机器学习管道
- 模型管理
- 特征工程

## 设计原则

### SOLID 原则

- **单一职责** - 每个类只负责一个功能
- **开闭原则** - 对扩展开放，对修改关闭
- **里氏替换** - 子类可以替换父类
- **接口隔离** - 接口应该小而专注
- **依赖倒置** - 依赖抽象而非具体实现

### 依赖注入

框架深度集成 .NET 依赖注入：

- 服务注册自动化
- 生命周期管理
- 约定式注册
- 模块化注册

### 异步优先

全面支持异步编程：

- 所有 I/O 操作异步化
- 使用 async/await 模式
- 避免同步阻塞
- 提高并发性能

## 最佳实践

### 模块化开发

- 按功能划分模块
- 模块独立开发和测试
- 清晰的模块依赖关系
- 避免循环依赖

### 领域模型

- 丰富的领域模型
- 将业务逻辑放在领域层
- 使用值对象表示概念
- 通过领域事件解耦

### 数据访问

- 使用仓储模式
- 通过工作单元管理事务
- 使用规约封装查询
- 启用审计追踪

### 异常处理

- 使用结果模式代替异常
- 在边界处处理异常
- 记录异常详情
- 提供友好的错误信息

## 快速开始

### 安装框架

通过 NuGet 安装核心模块：

```bash
dotnet add package XiHan.Framework.Core
dotnet add package XiHan.Framework.Web.Core
```

### 配置应用

创建模块类并配置依赖：

```bash
# 配置数据库连接字符串
# 配置 Redis 连接
# 配置日志输出
```

### 使用功能

根据需要引入其他模块，享受框架带来的便利。

## 进阶主题

- [依赖注入详解](./core/dependency-injection.md)
- [数据访问进阶](./data/advanced.md)
- [事件总线实战](./event-bus/guide.md)
- [多租户实现](./multi-tenancy/implementation.md)
- [性能优化指南](./performance/optimization.md)

## 更多资源

- [API 文档](https://apidocs.xihanfun.com)
- [示例代码](https://github.com/XiHanFun/XiHan.Framework/tree/main/samples)
- [视频教程](https://space.bilibili.com/xihanfun)
